import{_ as E,a as y,b as i}from"./chunks/PageInfo.vue_vue_type_script_setup_true_lang.bc46e4f5.js";import{_ as u}from"./chunks/CustomLink.cd661532.js";import{_ as d}from"./chunks/CloudinaryImg.vue_vue_type_script_setup_true_lang.87fcf701.js";import{_ as b}from"./chunks/VideoLink.vue_vue_type_script_setup_true_lang.4aa17f81.js";import{_ as F,o as m,c as h,H as n,w as C,k as s,a,Q as o}from"./chunks/framework.926cbeec.js";import"./chunks/commonjsHelpers.725317a4.js";const M=JSON.parse('{"title":"tRPC æ˜¯ä»€ä¹ˆï¼Ÿä¸ REST å’Œ GraphQL æœ‰å•¥å…³ç³» | ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„ APIï¼","description":"","frontmatter":{"author":"Choi Yang","date":"2023-05-28T00:00:00.000Z"},"headers":[],"relativePath":"program/trpc/index.md","filePath":"program/trpc/index.md","lastUpdated":1696923443000}'),A={name:"program/trpc/index.md"},g=s("h1",{id:"trpc-æ˜¯ä»€ä¹ˆ-ä¸-rest-å’Œ-graphql-æœ‰å•¥å…³ç³»-ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„-api",tabindex:"-1"},[a("tRPC æ˜¯ä»€ä¹ˆï¼Ÿä¸ REST å’Œ GraphQL æœ‰å•¥å…³ç³» | ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„ APIï¼ "),s("a",{class:"header-anchor",href:"#trpc-æ˜¯ä»€ä¹ˆ-ä¸-rest-å’Œ-graphql-æœ‰å•¥å…³ç³»-ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„-api","aria-label":'Permalink to "tRPC æ˜¯ä»€ä¹ˆï¼Ÿä¸ REST å’Œ GraphQL æœ‰å•¥å…³ç³» | ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„ APIï¼"'},"â€‹")],-1),D=s("h2",{id:"ä»€ä¹ˆæ˜¯-trpc",tabindex:"-1"},[a("ä»€ä¹ˆæ˜¯ tRPC "),s("a",{class:"header-anchor",href:"#ä»€ä¹ˆæ˜¯-trpc","aria-label":'Permalink to "ä»€ä¹ˆæ˜¯ tRPC"'},"â€‹")],-1),B=s("p",null,"tRPC æ˜¯ä¸€ä¸ªåŸºäº TypeScript çš„ RPC æ¡†æ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®©å‰åç«¯çš„å¼€å‘è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹å‡½æ•°ï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚ã€‚",-1),q=s("p",null,"tRPC çš„ç›®æ ‡æ˜¯è®©å‰åç«¯çš„å¼€å‘è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹å‡½æ•°ï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚ã€‚",-1),v=s("p",null,"ç›´æ¥çœ‹åˆ°ï¼Œè¿™é‡Œå°±ä¸æ¬è¿å®˜ç½‘å†…å®¹äº†ã€‚",-1),_=s("h2",{id:"æœ¬æ–‡å†…å®¹",tabindex:"-1"},[a("æœ¬æ–‡å†…å®¹ "),s("a",{class:"header-anchor",href:"#æœ¬æ–‡å†…å®¹","aria-label":'Permalink to "æœ¬æ–‡å†…å®¹"'},"â€‹")],-1),P=s("p",null,[a("æœ¬æ–‡ä¼šå¸¦ä½ å®ç°ä¸€ä¸ªæç®€çš„ tRPC é¡¹ç›®ï¼Œå®ç° "),s("code",null,"examples-minimal"),a("ã€‚")],-1),f=s("blockquote",null,[s("p",null,"ç›¸å…³æºç å¦‚ä¸‹ï¼š")],-1),k=o(`<p>tRPC åˆ†ä¸ºå‡ ä¸ªåŒ…ï¼Œæ‰€ä»¥ä½ å¯ä»¥åªå®‰è£…ä½ éœ€è¦çš„ï¼Œç¡®ä¿åœ¨ä»£ç åº“çš„é€‚å½“éƒ¨åˆ†å®‰è£…æ‰€éœ€çš„åŒ…ã€‚</p><p>é¦–å…ˆå®‰è£… <code>@trpc/server</code> å’Œ <code>@trpc/client</code> åŒ…ï¼Œè¿™ä¸¤ä¸ªåŒ…åˆ†åˆ«ä½¿ç”¨äºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@trpc/server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@trpc/client</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@trpc/server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@trpc/client</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="ç¼–å†™åç«¯é€»è¾‘" tabindex="-1">ç¼–å†™åç«¯é€»è¾‘ <a class="header-anchor" href="#ç¼–å†™åç«¯é€»è¾‘" aria-label="Permalink to &quot;ç¼–å†™åç«¯é€»è¾‘&quot;">â€‹</a></h2><p>æˆ‘ä»¬ä¸æ‰“ç®—æŠŠé¡¹ç›®å¼„å¤æ‚äº†ï¼Œå› æ­¤å¯¹äºåç«¯æ•°æ®åº“è€Œè¨€ï¼Œæˆ‘ä»¬ä½¿ç”¨è™šæ‹Ÿçš„ï¼Œç”¨ä¸€ä¸ªæ•°ç»„å³å¯ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><p><code>server/db.ts</code></p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">id</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#FFAB70;">email</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#FFAB70;">password</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Imaginary database</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">users</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">User</span><span style="color:#E1E4E8;">[] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [];</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">db</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  user: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">findMany</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> users,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">findById</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">id</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> users.</span><span style="color:#B392F0;">find</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">user</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> user.id </span><span style="color:#F97583;">===</span><span style="color:#E1E4E8;"> id),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">data</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> { </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#FFAB70;">email</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">; </span><span style="color:#FFAB70;">password</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> { id: </span><span style="color:#B392F0;">String</span><span style="color:#E1E4E8;">(users.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">), </span><span style="color:#F97583;">...</span><span style="color:#E1E4E8;">data };</span></span>
<span class="line"><span style="color:#E1E4E8;">      users.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(user);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> user;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { </span><span style="color:#E36209;">id</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#E36209;">email</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#E36209;">password</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Imaginary database</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">users</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">User</span><span style="color:#24292E;">[] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [];</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">db</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  user: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">findMany</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> users,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">findById</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">id</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> users.</span><span style="color:#6F42C1;">find</span><span style="color:#24292E;">((</span><span style="color:#E36209;">user</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> user.id </span><span style="color:#D73A49;">===</span><span style="color:#24292E;"> id),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">data</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> { </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#E36209;">email</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">; </span><span style="color:#E36209;">password</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;"> }) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">user</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> { id: </span><span style="color:#6F42C1;">String</span><span style="color:#24292E;">(users.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">), </span><span style="color:#D73A49;">...</span><span style="color:#24292E;">data };</span></span>
<span class="line"><span style="color:#24292E;">      users.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(user);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> user;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>åœ¨æ¨¡æ‹Ÿçš„ <code>db</code> å¯¹è±¡ä¸­æœ‰ä¸€äº›æ•°æ®çš„æ“ä½œæ–¹æ³•ï¼Œå¦‚ <code>findById</code> å’Œ <code>create</code>ï¼Œè¿™äº›æ–¹æ³•ä¼šåœ¨åé¢çš„ä»£ç ä¸­ç”¨åˆ°ï¼Œä¹Ÿå¦‚å­—é¢æ„æ€ä¸€æ ·ï¼Œ<code>findById</code> ç”¨äºæ ¹æ® <code>id</code> æŸ¥æ‰¾ç”¨æˆ·ï¼Œ<code>create</code> ç”¨äºåˆ›å»ºç”¨æˆ·ã€‚</p><p>æ¥ä¸‹æ¥åˆ›å»º <code>server/trpc.ts</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { initTRPC } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@trpc/server&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Initialization of tRPC backend</span></span>
<span class="line"><span style="color:#6A737D;"> * Should be done only once per backend!</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">t</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> initTRPC.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Export reusable router and procedure helpers</span></span>
<span class="line"><span style="color:#6A737D;"> * that can be used throughout the router</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">router</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> t.router;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">publicProcedure</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> t.procedure;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { initTRPC } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@trpc/server&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Initialization of tRPC backend</span></span>
<span class="line"><span style="color:#6A737D;"> * Should be done only once per backend!</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">t</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> initTRPC.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/**</span></span>
<span class="line"><span style="color:#6A737D;"> * Export reusable router and procedure helpers</span></span>
<span class="line"><span style="color:#6A737D;"> * that can be used throughout the router</span></span>
<span class="line"><span style="color:#6A737D;"> */</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">router</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> t.router;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">publicProcedure</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> t.procedure;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>åœ¨ <code>server/trpc.ts</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº† tRPC åç«¯ï¼Œç„¶åå¯¼å‡ºäº† <code>router</code> å’Œ <code>publicProcedure</code> ä¸¤ä¸ªå˜é‡ï¼Œè¿™ä¸¤ä¸ªå˜é‡ä¼šåœ¨åé¢çš„ä»£ç ä¸­ç”¨åˆ°ã€‚</p><p>æ¥ç€ï¼Œæœ‰äº†å‰é¢é“ºå«ï¼Œå°±æ˜¯ç¼–å†™åç«¯é€»è¾‘äº†ï¼Œæˆ‘ä»¬åœ¨ <code>server/index.ts</code> æ–‡ä»¶ä¸­ç¼–å†™åç«¯é€»è¾‘ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { db } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./db&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { publicProcedure, router } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./trpc&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createHTTPServer } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@trpc/server/adapters/standalone&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> z </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;zod&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">appRouter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">router</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  userList: publicProcedure.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Retrieve users from a datasource, this is an imaginary database</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">users</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> db.user.</span><span style="color:#B392F0;">findMany</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> users;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }),</span></span>
<span class="line"><span style="color:#E1E4E8;">  userById: publicProcedure</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">input</span><span style="color:#E1E4E8;">(z.</span><span style="color:#B392F0;">object</span><span style="color:#E1E4E8;">({ id: z.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">() }))</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">input</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">id</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> input;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> db.user.</span><span style="color:#B392F0;">findById</span><span style="color:#E1E4E8;">(id);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> user;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#E1E4E8;">  userCreate: publicProcedure</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">input</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">      z.</span><span style="color:#B392F0;">object</span><span style="color:#E1E4E8;">({ name: z.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">(), email: z.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">(), password: z.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">() })</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span></span>
<span class="line"><span style="color:#E1E4E8;">    .</span><span style="color:#B392F0;">mutation</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> ({ </span><span style="color:#FFAB70;">input</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> db.user.</span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">(input);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> user;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Export type router type signature,</span></span>
<span class="line"><span style="color:#6A737D;">// NOT the router itself.</span></span>
<span class="line highlighted"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AppRouter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">typeof</span><span style="color:#E1E4E8;"> appRouter;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createHTTPServer</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  router: appRouter,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">server.</span><span style="color:#B392F0;">listen</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3000</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { db } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./db&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { publicProcedure, router } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./trpc&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createHTTPServer } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@trpc/server/adapters/standalone&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> z </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;zod&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">appRouter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">router</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  userList: publicProcedure.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Retrieve users from a datasource, this is an imaginary database</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">users</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> db.user.</span><span style="color:#6F42C1;">findMany</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> users;</span></span>
<span class="line"><span style="color:#24292E;">  }),</span></span>
<span class="line"><span style="color:#24292E;">  userById: publicProcedure</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">input</span><span style="color:#24292E;">(z.</span><span style="color:#6F42C1;">object</span><span style="color:#24292E;">({ id: z.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">() }))</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> ({ </span><span style="color:#E36209;">input</span><span style="color:#24292E;"> }) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">id</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> input;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">user</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> db.user.</span><span style="color:#6F42C1;">findById</span><span style="color:#24292E;">(id);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> user;</span></span>
<span class="line"><span style="color:#24292E;">    }),</span></span>
<span class="line"><span style="color:#24292E;">  userCreate: publicProcedure</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">input</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">      z.</span><span style="color:#6F42C1;">object</span><span style="color:#24292E;">({ name: z.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">(), email: z.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">(), password: z.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">() })</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">    .</span><span style="color:#6F42C1;">mutation</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> ({ </span><span style="color:#E36209;">input</span><span style="color:#24292E;"> }) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">user</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> db.user.</span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">(input);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> user;</span></span>
<span class="line"><span style="color:#24292E;">    }),</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Export type router type signature,</span></span>
<span class="line"><span style="color:#6A737D;">// NOT the router itself.</span></span>
<span class="line highlighted"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AppRouter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">typeof</span><span style="color:#24292E;"> appRouter;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">server</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createHTTPServer</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  router: appRouter,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">server.</span><span style="color:#6F42C1;">listen</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3000</span><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>è¿™é‡Œæˆ‘ä»¬å¯¼å…¥äº† <code>db</code>ã€<code>publicProcedure</code> å’Œ <code>router</code>ï¼Œç„¶ååˆ›å»ºäº† <code>appRouter</code>ï¼Œ<code>appRouter</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«äº† <code>userList</code>ã€<code>userById</code> å’Œ <code>userCreate</code> ä¸‰ä¸ªå±æ€§ï¼Œè¿™ä¸‰ä¸ªå±æ€§åˆ†åˆ«å¯¹åº”äº† <code>publicProcedure.query</code>ã€<code>publicProcedure.query</code> å’Œ <code>publicProcedure.mutation</code>ï¼Œè¿™ä¸‰ä¸ªå±æ€§çš„å€¼éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»£ç çš„ç¬¬ 31 è¡Œæˆ‘æ ‡æ³¨äº†ä¸€ä¸‹ï¼Œè¿™é‡Œå¯¼å‡ºçš„æ˜¯ <code>AppRouter</code> ç±»å‹ï¼Œè€Œä¸æ˜¯ <code>appRouter</code> å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸º <code>appRouter</code> å¯¹è±¡ä¸­çš„ <code>userList</code>ã€<code>userById</code> å’Œ <code>userCreate</code> ä¸‰ä¸ªå±æ€§çš„ç±»å‹éƒ½æ˜¯ <code>Procedure</code>ï¼Œè€Œ <code>Procedure</code> æ˜¯ä¸€ä¸ªæ³›å‹ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¾“å…¥ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å‡ºç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¼å‡º <code>AppRouter</code> ç±»å‹ï¼Œè¿™æ ·åœ¨åé¢çš„ä»£ç ä¸­æ‰èƒ½ä½¿ç”¨ <code>AppRouter</code> ç±»å‹ã€‚</p><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨å‰ç«¯è°ƒç”¨åç«¯ api çš„æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡ <code>.</code> å°±å¯ä»¥è·å¾—å¯¹åº”çš„å±æ€§å’Œæ–¹æ³•äº†ã€‚</p><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬åç«¯çš„é€»è¾‘å·®ä¸å¤šå†™å®Œäº†ï¼Œå°†å¯¹åº”çš„ <code>appRouter</code> ä¼ å…¥ <code>createHTTPServer</code> å‡½æ•°ä¸­ï¼Œç„¶åç›‘å¬ 3000 ç«¯å£å³å¯ï¼Œä¸‹é¢æˆ‘ä»¬å³å°†ç¼–å†™å‰ç«¯é€»è¾‘ï¼Œæ¥è°ƒç”¨åç«¯çš„æ¥å£è¯•ä¸€è¯•ã€‚</p><h2 id="ç¼–å†™å‰ç«¯é€»è¾‘" tabindex="-1">ç¼–å†™å‰ç«¯é€»è¾‘ <a class="header-anchor" href="#ç¼–å†™å‰ç«¯é€»è¾‘" aria-label="Permalink to &quot;ç¼–å†™å‰ç«¯é€»è¾‘&quot;">â€‹</a></h2><p>ç”±äºå‰ç«¯åªç”¨è´Ÿè´£è°ƒç”¨ apiï¼Œæ‰€ä»¥ä»£ç å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ <code>client/index.ts</code> æ‰€ç¤ºï¼š</p><div class="language-typescript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { createTRPCProxyClient, httpBatchLink } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@trpc/client&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> { AppRouter } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;../server&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;">//     ğŸ‘† **type-only** import</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Pass AppRouter as generic here. ğŸ‘‡ This lets the \`trpc\` object know</span></span>
<span class="line"><span style="color:#6A737D;">// what procedures are available on the server and their input/output types.</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">trpc</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">createTRPCProxyClient</span><span style="color:#E1E4E8;">&lt;</span><span style="color:#B392F0;">AppRouter</span><span style="color:#E1E4E8;">&gt;({</span></span>
<span class="line"><span style="color:#E1E4E8;">  links: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">httpBatchLink</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">      url: </span><span style="color:#9ECBFF;">&quot;http://localhost:3000&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    }),</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">createdUser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> trpc.userCreate.</span><span style="color:#B392F0;">mutate</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    name: </span><span style="color:#9ECBFF;">&quot;ä¸€ç™¾ä¸ªChocolate&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    email: </span><span style="color:#9ECBFF;">&quot;chocolate@qq.com&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    password: </span><span style="color:#9ECBFF;">&quot;Chocolate&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;createdUser: &quot;</span><span style="color:#E1E4E8;">, createdUser);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">userCreated</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> trpc.userById.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">({ id: </span><span style="color:#9ECBFF;">&quot;1&quot;</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;userCreated: &quot;</span><span style="color:#E1E4E8;">, userCreated);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">users</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> trpc.userList.</span><span style="color:#B392F0;">query</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Users:&quot;</span><span style="color:#E1E4E8;">, users);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { createTRPCProxyClient, httpBatchLink } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@trpc/client&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">type</span><span style="color:#24292E;"> { AppRouter } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;../server&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;">//     ğŸ‘† **type-only** import</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Pass AppRouter as generic here. ğŸ‘‡ This lets the \`trpc\` object know</span></span>
<span class="line"><span style="color:#6A737D;">// what procedures are available on the server and their input/output types.</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">trpc</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">createTRPCProxyClient</span><span style="color:#24292E;">&lt;</span><span style="color:#6F42C1;">AppRouter</span><span style="color:#24292E;">&gt;({</span></span>
<span class="line"><span style="color:#24292E;">  links: [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">httpBatchLink</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">      url: </span><span style="color:#032F62;">&quot;http://localhost:3000&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    }),</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">createdUser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> trpc.userCreate.</span><span style="color:#6F42C1;">mutate</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    name: </span><span style="color:#032F62;">&quot;ä¸€ç™¾ä¸ªChocolate&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    email: </span><span style="color:#032F62;">&quot;chocolate@qq.com&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    password: </span><span style="color:#032F62;">&quot;Chocolate&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;createdUser: &quot;</span><span style="color:#24292E;">, createdUser);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">userCreated</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> trpc.userById.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">({ id: </span><span style="color:#032F62;">&quot;1&quot;</span><span style="color:#24292E;"> });</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;userCreated: &quot;</span><span style="color:#24292E;">, userCreated);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">users</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> trpc.userList.</span><span style="color:#6F42C1;">query</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Users:&quot;</span><span style="color:#24292E;">, users);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">main</span><span style="color:#24292E;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>è¿™é‡Œæˆ‘ä»¬å¯¼å…¥äº† <code>createTRPCProxyClient</code> å’Œ <code>httpBatchLink</code>ï¼Œç„¶ååˆ›å»ºäº† <code>trpc</code> å¯¹è±¡ï¼Œ<code>trpc</code> å¯¹è±¡å°±æ˜¯æˆ‘ä»¬ç”¨æ¥è°ƒç”¨åç«¯ api çš„å¯¹è±¡ï¼Œå®ƒçš„å±æ€§å’Œæ–¹æ³•å°±æ˜¯åç«¯ <code>appRouter</code> å¯¹è±¡ä¸­çš„ <code>userList</code>ã€<code>userById</code> å’Œ <code>userCreate</code> ä¸‰ä¸ªå±æ€§ï¼Œè¿™ä¸‰ä¸ªå±æ€§çš„ç±»å‹éƒ½æ˜¯ <code>Procedure</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ <code>.</code> æ¥è°ƒç”¨è¿™ä¸‰ä¸ªå±æ€§ã€‚</p><h3 id="ç¼–å†™-script-è„šæœ¬" tabindex="-1">ç¼–å†™ script è„šæœ¬ <a class="header-anchor" href="#ç¼–å†™-script-è„šæœ¬" aria-label="Permalink to &quot;ç¼–å†™ script è„šæœ¬&quot;">â€‹</a></h3><p>ä¸ºäº†è®©æˆ‘ä»¬å‰åç«¯ä»£ç è·‘èµ·æ¥ï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹é¡¹ç›®çš„ script è„šæœ¬ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// xxx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;client:dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;esno client&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;server:dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;esno server&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// xxx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;scripts&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;client:dev&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;esno client&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;server:dev&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;esno server&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// ...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨çš„ <code>esno</code> æ¥æ‰§è¡Œæˆ‘ä»¬çš„ ts æ–‡ä»¶ã€‚ä¹Ÿéœ€è¦å®‰è£…ä¸€ä¸‹ï¼š</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">esno</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">esno</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p><code>esno</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå¯ä»¥ç›´æ¥æ‰§è¡Œ ts æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬å…ˆç¼–è¯‘æˆ js æ–‡ä»¶ï¼Œç„¶åå†æ‰§è¡Œ js æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥çœå»ç¼–è¯‘çš„è¿‡ç¨‹äº†ã€‚</p></blockquote><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>npm run client:dev</code> å’Œ <code>npm run server:dev</code> æ¥åˆ†åˆ«å¯åŠ¨å‰ç«¯å’Œåç«¯äº†ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰§è¡Œ <code>npm run server:dev</code>ï¼Œç„¶åå†æ‰§è¡Œ <code>npm run client:dev</code>ï¼Œå› ä¸ºå‰ç«¯éœ€è¦è°ƒç”¨åç«¯çš„æ¥å£ï¼Œæ‰€ä»¥åç«¯å¿…é¡»å…ˆå¯åŠ¨èµ·æ¥ï¼Œå¦åˆ™å‰ç«¯å°±ä¼šæŠ¥é”™ã€‚</p><p>å½“ç„¶ï¼Œè¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>wait-port</code> ä»¥åŠ <code>npm-run-all</code> æ¥å®ç°å‰åç«¯ä¸€èµ·å¯åŠ¨ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿›é˜¶ç¯‡æ¥ä»‹ç»ï¼Œè¿™é‡Œå°±å…ˆä¸å±•ç¤ºäº†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹æ‰“å°ç»“æœï¼š</p>`,30),R=o('<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸçš„è°ƒç”¨äº†åç«¯çš„æ¥å£ï¼Œè·å–åˆ°äº†æ•°æ®ã€‚</p><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªç®€å•çš„ tRPC é¡¹ç›®ï¼Œæˆ‘ä»¬ä½¿ç”¨ tRPC æ¥åˆ›å»ºäº†ä¸€ä¸ªåç«¯ apiï¼Œç„¶ååœ¨å‰ç«¯ä½¿ç”¨ tRPC æ¥è°ƒç”¨åç«¯çš„æ¥å£ï¼Œè·å–åˆ°äº†æ•°æ®ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>httpBatchLink</code>ï¼Œä¹Ÿå°±æ˜¯ http åè®®ï¼Œå½“ç„¶ tRPC è¿˜æ”¯æŒå…¶ä»–çš„åè®®ï¼Œæ¯”å¦‚ <code>wsLink</code>ã€<code>grpcLink</code>ã€<code>reactQueryLink</code> ç­‰ç­‰ï¼Œå¯ä»¥ä»å®˜ç½‘æ–‡æ¡£ä¸­è¿›ä¸€æ­¥å­¦ä¹ ã€‚</p><h2 id="æ–‡ç« å‚è€ƒ" tabindex="-1">æ–‡ç« å‚è€ƒ <a class="header-anchor" href="#æ–‡ç« å‚è€ƒ" aria-label="Permalink to &quot;æ–‡ç« å‚è€ƒ&quot;">â€‹</a></h2>',5),x=s("h2",{id:"contributors",tabindex:"-1"},[a("Contributors "),s("a",{class:"header-anchor",href:"#contributors","aria-label":'Permalink to "Contributors"'},"â€‹")],-1);function T(w,I,S,L,z,U){const e=E,r=b,l=d,p=u,c=y,t=i;return m(),h("div",null,[g,n(e,{readTime:"6",words:"1.7k"}),n(r,{bvId:"BV17z4y1z7xa"},{default:C(()=>[a("tRPC æ˜¯ä»€ä¹ˆï¼Ÿä¸ REST å’Œ GraphQL æœ‰å•¥å…³ç³» | ä½ å¯èƒ½ä¸å†éœ€è¦ä¼ ç»Ÿçš„ APIï¼")]),_:1}),D,B,q,n(l,{publicId:"program/iShot_2023-06-04_20.54.29_jhvnxf",alt:"trpc"}),s("p",null,[a("ç›¸å…³ç‰¹ç‚¹å¯ä»¥ä» "),n(p,{title:"tRPC å®˜ç½‘",href:"https://trpc.io/"})]),v,_,P,f,n(p,{title:"examples-minimal é¡¹ç›®æºç ",href:"https://github.com/chonext/trpc-practice/tree/main/examples-minimal"}),k,n(l,{publicId:"program/iShot_2023-06-04_21.24.18_h7hzpm",alt:"console"}),R,n(p,{title:"tRPC å®˜æ–¹æ–‡æ¡£",href:"https://trpc.io/docs/"}),n(p,{title:"Learn tRPC In 45 Minutes",href:"https://www.youtube.com/watch?v=UfUbBWIFdJs"}),x,n(c),n(t)])}const G=F(A,[["render",T]]);export{M as __pageData,G as default};
